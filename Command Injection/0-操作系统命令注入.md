# 操作系统命令注入

> OS command injection：https://portswigger.net/web-security/os-command-injection

## 什么是操作系统命令注入？

OS命令注入(也称为shell注入)是一个web安全漏洞，它允许攻击者在运行应用程序的服务器上执行任意操作系统(OS)命令，通常会完全危及应用程序及其所有数据。通常，攻击者可以利用OS命令注入漏洞来破坏托管基础设施的其他部分，利用信任关系将攻击转移到组织内的其他系统。

## 注入操作系统命令的方法

可以使用各种shell元字符来执行OS命令注入攻击。

许多字符充当命令分隔符，允许将命令链接在一起。下面的命令分隔符可以在Windows和unix系统上使用:

- - `&`
  - `&&`
  - `|`
  - `||`

下面的命令分隔符只适用于基于unix的系统:

- - `;`
  - Newline (`0x0a` or `\n`) 

在基于unix的系统上，您还可以使用反引号或美元字符在原始命令内执行注入命令:

- - \` injected command `
  - `$(` injected command `)`

请注意，不同的shell元字符具有细微的不同行为，这些行为可能会影响它们是否在某些情况下工作，以及它们是否允许带内检索命令输出，还是只对 blind exploitation 有用。

有时，您控制的输入出现在原始命令的引号中。在这种情况下，在使用合适的shell元字符注入新命令之前，需要终止引用的上下文(使用 " 或 ' )。

## 如何阻止操作系统命令注入攻击？

到目前为止，防止OS命令注入漏洞的最有效方法是永远不要从应用层代码调用OS命令。实际上，在每种情况下，都有使用更安全的平台api实现所需功能的替代方法。

如果认为不可避免地使用用户提供的输入调用OS命令，那么必须执行强输入验证。一些有效验证的例子包括:

- - 根据允许值的白名单进行验证。
  - 验证输入是否是一个数字。
  - 验证输入是否只包含字母数字字符，不包含其他语法或空格。

永远不要试图通过转义shell元字符来清理输入。在实践中，这太容易出错，而且很容易被熟练的攻击者绕过。