# 12-Locating Public Exploits

## 警告的话

重要的是要明白，通过下载和运行公共漏洞，我们可以极大地威胁到任何运行该代码的系统。考虑到这一点，我们需要在执行之前仔细阅读和理解代码，以确保没有负面影响。

以0pen0wn为例，它是作为SSH的远程漏洞发布的。在阅读源代码时，我们注意到它要求root权限，这立即引起了怀疑:

![image.png](https://cdn.nlark.com/yuque/0/2020/png/2398693/1605947175115-104d8609-e39f-4eb3-87d6-538bd7cdc55e.png)

对有效负载的进一步检查显示了一个有趣的jmpcode数组:

![image.png](https://cdn.nlark.com/yuque/0/2020/png/2398693/1605947191883-91587473-b1cd-44cc-a569-937b2b240582.png)

尽管它被伪装成shell代码，jmpcode字符数组实际上是一个十六进制编码的字符串，包含一个恶意的shell命令:

![image.png](https://cdn.nlark.com/yuque/0/2020/png/2398693/1605947209017-ab94a49f-e58d-40e7-81f2-8f5f16c2af7e.png)

这个命令可以有效地清除攻击者基于unix的文件系统。在接下来的几行中，程序将连接到一个公共IRC服务器，向全世界宣布用户的愚蠢行为，这是一个极其危险的，并且可能令人尴尬的恶意利用!

所以说，如果使用公开的漏洞利用资源时，要谨慎使用，下面介绍的是相对可信的利用来源，如果代码检查或编译太复杂，可以设置一个带有干净快照的虚拟机作为开发测试场地或“沙箱”。

## 寻找利用

在渗透测试的信息收集和列举阶段之后，我们可以对已发现的软件进行交叉检查以找出已知的漏洞，试图找到针对这些漏洞的已发布的利用。

### 在线利用资源

#### The Exploit Database

利用数据库是一个由进攻性安全维护的项目。它是一个公共利用的免费档案，通过提交，邮件列表，和公共资源收集。

与其他在线资源相比，漏洞利用数据库偶尔会提供软件易受攻击版本的安装程序，以供研究之用。当安装程序可用时，它会在网站上用一个图标标记出来。

#### SecurityFocus Exploit Archives

SecurityFocus Exploit Archives 网站创建于1999年，专注于对安全社区重要的几个关键领域:

- BugTraq:一个完整的公开邮件列表，用于讨论和宣布安全漏洞。
- The SecurityFocus Vulnerability Database:为所有平台和服务的漏洞提供最新的信息。
- SecurityFocus Mailing Lists:基于主题的邮件列表允许世界各地的研究人员讨论各种安全问题。

#### Packet Storm

Packet Storm成立于1998年。它提供有关安全新闻和漏洞的最新信息，以及安全供应商最近发布的工具。

#### 谷歌搜索引擎

除了我们上面提到的个别网站，我们还可以使用传统搜索引擎搜索其他的利用网站。

这里就涉及到Google hacking，就是利用谷歌的搜索技巧，例如site、inurl等等，这里会附加一个链接，后面可以仔细看一下。

> GoogleHacking-Page:https://github.com/K0rz3n/GoogleHacking-Page

### 离线利用资源

在渗透测试期间，对Internet的访问并不总是保证的。如果评估是在一个隔离的环境中进行的，那么Kali Linux发行版提供了各种工具来提供对漏洞的离线访问。

#### SearchSploit

The Exploit Database 提供了一个可下载的所有托管利用代码的存档副本。

默认情况下，这个归档文件包含在Kali的exploitdb包中。建议您在任何评估之前更新包，以确保您有最新的漏洞。可以使用以下命令更新包:

```
sudo apt update && sudo apt install exploitdb
```

上面的命令更新/usr/share/expoitdb/下的利用数据库存档的本地副本。这个目录分为两个主要部分，利用和shell代码:

![image.png](https://cdn.nlark.com/yuque/0/2020/png/2398693/1605947997924-1d13f393-2646-46a3-84bb-e4f3d1a5cdec.png)

我们可以用 `searchsploit` 进行搜索，可以在什么参数都不加的情况下运行，查看它的使用方法。

![image.png](https://cdn.nlark.com/yuque/0/2020/png/2398693/1605948137427-1c77c016-3581-4b5b-bc82-f602b006fbe0.png)

![image.png](https://cdn.nlark.com/yuque/0/2020/png/2398693/1605948169060-682e9331-0024-4c70-a514-9bedc7b6c36f.png)

![image.png](https://cdn.nlark.com/yuque/0/2020/png/2398693/1605948180597-b8aad447-eb96-43ee-917f-95434e86db2b.png)

例如，我们可以使用以下语法搜索所有针对Windows操作系统上SMB服务的可用远程攻击:

```
searchsploit remote smb microsoft windows
```

![image.png](https://cdn.nlark.com/yuque/0/2020/png/2398693/1605948316294-c91ceab6-8f51-4dc4-9430-1ce028f6fd3a.png)

#### Nmap NSE Scripts

Nmap是枚举中最流行的工具之一。这个工具的一个非常强大的特性是Nmap脚本引擎，顾名思义，它引入了使用脚本自动化各种任务的能力。

Nmap脚本引擎提供了各种各样的脚本，用于枚举、强力、模糊、检测以及利用服务。Nmap脚本引擎提供的完整脚本列表可以在/usr/share/nmap/scripts下找到。使用grep快速搜索单词“exploit”的NSE脚本会返回一些结果:

![image.png](https://cdn.nlark.com/yuque/0/2020/png/2398693/1605948417153-a79eb19d-cf66-4f81-9557-efd8b5cfb6a3.png)

可以用 `--script-help` 选项进行查看脚本的信息：

![image.png](https://cdn.nlark.com/yuque/0/2020/png/2398693/1605948501129-9d354c63-fb25-447b-8a8e-665895c47160.png)

#### The Browser Exploitation Framework (BeEF)

浏览器开发框架(BeEF) 是一个渗透测试工具，专注于在web浏览器中执行的客户端攻击。不用说，它包含了大量的exploit。

启动： `sudo beef-xss` 

启动之后可以在 http://127.0.0.1:3000/ui/panel 进行访问后台，页面上有一个here可以打开demo页面，然后你的后台就会有一个127.0.0.1的主机上线，可以进行很多操作。

![image.png](https://cdn.nlark.com/yuque/0/2020/png/2398693/1605948680519-ed99a6bb-2da5-408e-a8b3-b3513de2198d.png?x-oss-process=image%2Fresize%2Cw_1500)

#### The Metasploit Framework

Metasploit 是一个用来帮助开发和执行exploit的优秀框架。这个框架在Kali Linux中默认是可用的，可以通过msfconsole命令启动:

```
sudo msfconsole -q
```

这个框架的用法将在另一个模块中深入介绍，因此我们将只关注于列出框架中使用search命令可用的漏洞。

![image.png](https://cdn.nlark.com/yuque/0/2020/png/2398693/1605948797483-ca6536d9-3906-4050-a318-ac74a57b08ed.png)

用 `search -h` 可以列出相关的关键词和选项，帮助我们去更好的检索需要的漏洞利用。

## 把它们放在一起

上面列出了各种渠道，但是当我们在真实场景中去查找利用的时候，要学会结合起来使用，这样才能达到更好的效果。