# XXE（XML 外部实体）

> XML external entity injection：https://portswigger.net/web-security/xxe

## 什么是XML外部实体注入？

XML外部实体注入(也称为XXE)是一个web安全漏洞，允许攻击者干扰应用程序对XML数据的处理。它通常允许攻击者查看应用服务器文件系统上的文件，并与应用程序本身可以访问的任何后端或外部系统交互。

在某些情况下，攻击者可以通过利用XXE漏洞来执行服务器端请求伪造(SSRF)攻击，从而升级XXE攻击以危及底层服务器或其他后端基础设施。

## XXE漏洞是如何产生的？

> XML&XML entities：https://portswigger.net/web-security/xxe/xml-entities

一些应用程序使用XML格式在浏览器和服务器之间传输数据。这样做的应用程序实际上总是使用标准库或平台API来处理服务器上的XML数据。XXE漏洞的出现是因为XML规范包含各种潜在危险的特性，而标准解析器支持这些特性，即使应用程序通常不使用这些特性。

XML外部实体是一种自定义XML实体，其定义的值是从声明它们的DTD外部加载的。从安全的角度来看，外部实体特别有趣，因为它们允许根据文件路径或URL的内容定义实体。

XXE漏洞就是接受了用户提交的恶意的外部实体，并在后端进行解析执行了。

## XXE攻击的类型

> 大体上分为显式注入和隐式注入

XXE攻击有多种类型:

- - 利用XXE检索文件，其中定义了包含文件内容的外部实体，并在应用程序的响应中返回。
  - 利用XXE执行SSRF攻击，其中基于到后端系统的URL定义外部实体。
  - 利用blind XXE泄露数据带外，其中敏感数据从应用服务器传输到攻击者控制的系统。
  - 利用blind XXE通过错误消息检索数据，攻击者可以触发包含敏感数据的解析错误消息。

## 如何查找和测试XXE漏洞？

XXE漏洞手动测试一般包括:

- - 通过基于众所周知的操作系统文件定义外部实体并在应用程序响应中返回的数据中使用该实体来测试文件检索。
  - 通过基于您控制的系统的URL定义外部实体，并监视与该系统的交互，来测试blind XXE漏洞。Burp Collaborator客户端非常适合此目的。
  - 通过使用XInclude攻击来尝试检索已知的操作系统文件，测试服务器端XML文档中包含用户提供的非XML数据的脆弱性。

## 如何阻止XXE漏洞？

实际上，所有的XXE漏洞都是因为应用程序的XML解析库支持应用程序不需要或不打算使用的潜在危险的XML特性。防止XXE攻击最简单、最有效的方法是禁用这些特性。

通常，禁用外部实体的解析和禁用对XInclude的支持就足够了。这通常可以通过配置选项或通过编程重写默认行为来实现。有关如何禁用不必要功能的详细信息，请参阅XML解析库或API的文档。